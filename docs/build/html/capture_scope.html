

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Acquisition - Collecting Traces &mdash; Flexible Opensource workBench fOr Side-channel analysis (FOBOS) 2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Control Board Feature" href="controller_features.html" />
    <link rel="prev" title="Data Acquisition - Processing Data" href="capture_data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Flexible Opensource workBench fOr Side-channel analysis (FOBOS)
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="tvgen.html">Test Vector Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dutdev.html">DUT Algorithm Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="dut_board_setup.html">DUT Board Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="capture_data.html">Data Acquisition - Processing Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Acquisition - Collecting Traces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#picoscope-setup">PicoScope Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#power-measurement">Power Measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trace-collection-example">Trace Collection Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-traces">Visualizing Traces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="controller_features.html">Control Board Feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpa.html">Running Correlation Power Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="aes_cpa_example.html">Breaking AES Implementation With CPA</a></li>
<li class="toctree-l1"><a class="reference internal" href="t_test.html">T-test Leakage Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference_doc.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Flexible Opensource workBench fOr Side-channel analysis (FOBOS)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Data Acquisition - Collecting Traces</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/capture_scope.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-acquisition-collecting-traces">
<h1>Data Acquisition - Collecting Traces<a class="headerlink" href="#data-acquisition-collecting-traces" title="Permalink to this headline">¶</a></h1>
<p>This section explains how to use PicoScope to collect traces. This is best explained by example.</p>
<div class="section" id="picoscope-setup">
<h2>PicoScope Setup<a class="headerlink" href="#picoscope-setup" title="Permalink to this headline">¶</a></h2>
<p>This example code uses the Picoscope 5000 series (5244D) oscilloscope. To setup the oscilloscope please
refer to the manufacturer website.
We expect that modifying the code to work with other series to be easy since the manufacturer provides an SDK.</p>
</div>
<div class="section" id="power-measurement">
<h2>Power Measurement<a class="headerlink" href="#power-measurement" title="Permalink to this headline">¶</a></h2>
<p>The oscilloscope must be able to measure a voltage propotional to the power consumed by the device.
You can use a current probe (e.g Tektronix CT-1). As shown below, we modified the DUT board so that we
have jumper the power line (core FPGA voltage).
we then used a bench power supply to power the FPGA. Note that the power wire goes through the current probe.
The power probe senses the current variations in the power wire and coverts that to volatge for the oscilloscope.</p>
<p>TODO add figg</p>
<p>An alternative method is to inster a hunt resistor in the power line and then measure the volatge drop
across the resistor.</p>
<p>TODO: add fig</p>
</div>
<div class="section" id="trace-collection-example">
<h2>Trace Collection Example<a class="headerlink" href="#trace-collection-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">fobos</span>
<span class="c1"># Constants###########################################################</span>
<span class="n">SERIAL_PORT</span> <span class="o">=</span> <span class="s1">&#39;/dev/ttyUSB2&#39;</span>
<span class="n">TRACE_NUM</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">OUT_LEN</span> <span class="o">=</span> <span class="mi">7</span>
<span class="c1"># Instantiate FOBOS objects###########################################</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending configuration...&quot;</span><span class="p">)</span>
<span class="n">ctrl</span> <span class="o">=</span> <span class="n">fobos</span><span class="o">.</span><span class="n">Basys3Ctrl</span><span class="p">(</span><span class="n">SERIAL_PORT</span><span class="p">)</span>
<span class="n">ctrl</span><span class="o">.</span><span class="n">enableTestMode</span><span class="p">()</span>
<span class="n">ctrl</span><span class="o">.</span><span class="n">setOutLen</span><span class="p">(</span><span class="n">OUT_LEN</span><span class="p">)</span>
<span class="c1"># open file to save traces.</span>
<span class="n">traceFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;powerTraces.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="c1"># configure oscilloscope</span>
<span class="n">scope</span> <span class="o">=</span> <span class="n">fobos</span><span class="o">.</span><span class="n">picoscope</span><span class="o">.</span><span class="n">Picoscope</span><span class="p">(</span><span class="n">sampleResolution</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="c1"># number of bits for each sample.</span>
                    <span class="n">postTriggerSamples</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># samples in one trace.</span>
                    <span class="p">)</span>
<span class="n">scope</span><span class="o">.</span><span class="n">setChannel</span><span class="p">(</span><span class="n">channelName</span> <span class="o">=</span> <span class="s1">&#39;CHANNEL_A&#39;</span><span class="p">,</span> <span class="n">rangemv</span> <span class="o">=</span> <span class="s1">&#39;100mV&#39;</span><span class="p">)</span>
<span class="n">scope</span><span class="o">.</span><span class="n">setSamplingInterval</span><span class="p">(</span><span class="n">samplingIntervalns</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># T=2 ns, Sampling rate= 500MHz</span>
<span class="n">scope</span><span class="o">.</span><span class="n">setTrigger</span><span class="p">(</span><span class="n">channelName</span> <span class="o">=</span><span class="s1">&#39;EXTERNAL&#39;</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;RISING_EDGE&#39;</span><span class="p">,</span>
                <span class="n">thresholdmv</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">scope</span><span class="o">.</span><span class="n">setDataBuffers</span><span class="p">()</span>

<span class="c1"># Run DUT operations</span>
<span class="n">testVectors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;00c0000761996dc996d4ac00c100070f7821507a22a00081000700800001&#39;</span><span class="p">,</span>
            <span class="s1">&#39;00c00007fd8771fe717de400c100073e1fe5b4aa357c0081000700800001&#39;</span><span class="p">,</span>
            <span class="s1">&#39;00c0000782051f5484702200c10007980d05d4ea25bc0081000700800001&#39;</span><span class="p">,</span>
            <span class="s1">&#39;00c0000767881b702afe5200c10007b08a5e036de72b0081000700800001&#39;</span><span class="p">,</span>
            <span class="s1">&#39;00c0000726a1d601ccdf7a00c1000773539e52672d5d0081000700800001&#39;</span><span class="p">]</span>

<span class="nb">print</span> <span class="s1">&#39;Sending data..&#39;</span>
<span class="n">traceNum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">traceNum</span> <span class="o">&lt;</span> <span class="n">TRACE_NUM</span><span class="p">:</span>
    <span class="n">scope</span><span class="o">.</span><span class="n">arm</span><span class="p">()</span> <span class="c1"># arm scope. Now, it expects a trigger at any time.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">testVectors</span><span class="p">[</span><span class="n">traceNum</span><span class="p">]</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">processData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">OUT_LEN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">fobos</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;TIMEOUT&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">readTrace</span><span class="p">()</span> <span class="c1"># get trace from oscilloscope buffers.</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">traceFile</span><span class="p">,</span> <span class="n">trace</span><span class="p">)</span> <span class="c1"># save the trace in the trace file.</span>
    <span class="n">traceNum</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</td></tr></table></div>
<p>This is very similar to the capture data example but with few more lines added to capture traces
from the oscilloscope.</p>
<p>Lines 15-22 configure the oscilloscope settings. We first intantiate a Picoscope object (line 15).
Lines  15 sets sampleResolution to 8 bit and number of samples to be collected to 1000 samples per trace.
Line 18 enables channel A and sets its range to 100 mV.
Line 19 sets the sampling interval (T) to 2 nano seconds. This implies that ampling rate is 1/T = 500 M Sample/s.
Line 20 configers the EXTERNAL (Ext) channel to be used for trigger on risinge edge with a threshold of 200 mV.
Line 22 allocates memory buffers to store oscilloscope data.</p>
<p>In the main loop, we use the arm() (line 34) function to tell the oscilloscope to be ready to get the trigger and store the
data. Once the crypto operation is over, we can collect the trace from the memory as a numpy array using the
readTrace() method (line 40). The trace is saved into a file in line 41.
For more information about the PicoScope class see <a class="reference internal" href="reference_doc.html#Picoscope" title="Picoscope"><code class="xref py py-class docutils literal notranslate"><span class="pre">Picoscope</span></code></a>.</p>
</div>
<div class="section" id="visualizing-traces">
<h2>Visualizing Traces<a class="headerlink" href="#visualizing-traces" title="Permalink to this headline">¶</a></h2>
<p>TODO: prepare the viewPlots.py for realease.
You can use the plotTrace.py script to plot the traces form the file.
Otherwise you can use matplotlib to plot data as needed.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="controller_features.html" class="btn btn-neutral float-right" title="Control Board Feature" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="capture_data.html" class="btn btn-neutral float-left" title="Data Acquisition - Processing Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, CERG

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
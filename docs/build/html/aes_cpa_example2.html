

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AES CPA Example &mdash; FOBOS 2.0 2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="T-test Leakage Assessment" href="t_test.html" />
    <link rel="prev" title="Running Correlation Power Analysis" href="cpa.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> FOBOS 2.0
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="tvgen.html">Test Vector Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dut_board_setup.html">DUT Board Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="dutdev.html">DUT Algorithm Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="capture_data.html">Data Acquisition - Processing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="capture_scope.html">Data Acquisition - Collecting Traces</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller_features.html">Control Board Feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpa.html">Running Correlation Power Analysis</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">AES CPA Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="t_test.html">T-test Leakage Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="x_test.html">Chi-Squared Test Leakage Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference_doc.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">FOBOS 2.0</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>AES CPA Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/aes_cpa_example2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="aes-cpa-example">
<h1>AES CPA Example<a class="headerlink" href="#aes-cpa-example" title="Permalink to this headline">¶</a></h1>
<p>This section describes a Correlation Power Analysis (CPA) attack of an implementation of the
Advanced Encryption Standard (AES) using FOBOS. AES is an symmetric-key cipher used ex-
tensively in security sensitive applications world wide. AES applies four different transformations,
SubBytes, ShiftRows, MixColumns, and AddRoundKey, per round and iterates through several
such rounds depending upon the key size. An intermediate key called ”round key” is generated and
used per round which is derived from the original key through a reversible key scheduling function.
We have implemented a basic iterative architecture of AES with 128-bit key length and 128-bit
wide datapath requiring 11 clock cycles for one encryption. Key scheduling is done on-the-fly and
the SubBytes function is realized through look-up-tables. The block diagram for this design is
shown in the figure below:</p>
<div class="figure align-center" id="id1">
<img alt="_images/aes128.png" src="_images/aes128.png" />
<p class="caption"><span class="caption-text">AES-128 implementation</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>We attack our AES design during the first round at the output of the register FF1 (see the figure above). The equation for calculating the Hamming Distance (HD) is shown in the eqation below. We use
Pearson’s Correlation to correlate the instantaneous power consumption with the HD model.</p>
<blockquote>
<div><p>H(i,j) = HD(SBOX(CT(i) ), SBOX(kguess(j) xor PT(i+1) ))</p>
</div></blockquote>
<p>For trace collection, we used the Basys3 control board and connected a NewAE CW305 DUT (Artix7 FPGA).
The DUT clock was set to 1 MHz and the oscilloscope sampling rate was set to 62 M Sample/sec.
We then collected 500K traces.
The formula above was used to generate the hypothetical power matrix.</p>
<p>Below is the script used for the CPA analysis. This script is at fobos/software/cpaExample.py and the example files are
stored in fobos/workspace/aes_artix7_picoscope :</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">fobos.traceset</span> <span class="k">as</span> <span class="nn">traceset</span>
<span class="kn">import</span> <span class="nn">fobos.cpa</span> <span class="k">as</span> <span class="nn">cpa</span>
<span class="kn">import</span> <span class="nn">fobos.postprocess</span> <span class="k">as</span> <span class="nn">postprocess</span>
<span class="kn">import</span> <span class="nn">fobos.projmgr</span> <span class="k">as</span> <span class="nn">projmgr</span>
<span class="kn">import</span> <span class="nn">fobos.powermodels.AESFirstLast</span> <span class="k">as</span> <span class="nn">powermodel</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Configure project directories################################</span>
    <span class="n">WORKSPACE</span> <span class="o">=</span> <span class="s2">&quot;../workspace/aes_artix7_picoscope/capture&quot;</span>
    <span class="n">PROJECT_NAME</span> <span class="o">=</span> <span class="s2">&quot;aes_artix_pico_62MSps&quot;</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="n">projmgr</span><span class="o">.</span><span class="n">ProjectManager</span><span class="p">()</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">setWorkSpaceDir</span><span class="p">(</span><span class="n">WORKSPACE</span><span class="p">)</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">setProjName</span><span class="p">(</span><span class="n">PROJECT_NAME</span><span class="p">)</span>
    <span class="n">projDir</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">getProjDir</span><span class="p">()</span>
    <span class="n">analysisDir</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">getAnalysisDir</span><span class="p">()</span>
    <span class="c1">######</span>
    <span class="n">TRACES_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projDir</span><span class="p">,</span> <span class="s1">&#39;powerTraces.npy&#39;</span><span class="p">)</span>
    <span class="n">PLAIN_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projDir</span><span class="p">,</span> <span class="s1">&#39;plaintext.txt&#39;</span><span class="p">)</span>
    <span class="n">CIPHER_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projDir</span><span class="p">,</span> <span class="s1">&#39;ciphertext.txt&#39;</span><span class="p">)</span>
    <span class="n">HYPO_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projDir</span><span class="p">,</span> <span class="s2">&quot;hypotheticalPower.npy&quot;</span><span class="p">)</span>

    <span class="n">CROP_START</span> <span class="o">=</span> <span class="mi">218</span>
    <span class="n">CROP_END</span> <span class="o">=</span> <span class="mi">282</span>

    <span class="n">NUM_TRACES</span> <span class="o">=</span> <span class="mi">220000</span>
    <span class="n">MTD_STRIDE</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">traceSet</span> <span class="o">=</span> <span class="n">traceset</span><span class="o">.</span><span class="n">TraceSet</span><span class="p">(</span><span class="n">traceNum</span><span class="o">=</span><span class="n">NUM_TRACES</span><span class="p">,</span>
                                <span class="n">fileName</span><span class="o">=</span><span class="n">TRACES_FILE</span><span class="p">,</span>
                                <span class="n">cropStart</span><span class="o">=</span><span class="n">CROP_START</span><span class="p">,</span>
                                <span class="n">cropEnd</span><span class="o">=</span><span class="n">CROP_END</span><span class="p">)</span>

    <span class="n">measuredPower</span> <span class="o">=</span> <span class="n">traceSet</span><span class="o">.</span><span class="n">traces</span>
    <span class="n">hypotheticalPower</span> <span class="o">=</span> <span class="n">powermodel</span><span class="o">.</span><span class="n">getHypotheticalPower</span><span class="p">(</span><span class="n">PLAIN_FILE</span><span class="p">,</span>
                                                        <span class="n">CIPHER_FILE</span><span class="p">,</span>
                                                        <span class="n">NUM_TRACES</span><span class="p">)</span>
    <span class="c1"># hypotheticalPower = np.load(HYPO_FILE)</span>
    <span class="n">cpaAttacker</span> <span class="o">=</span> <span class="n">cpa</span><span class="o">.</span><span class="n">CPA</span><span class="p">()</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">cpaAttacker</span><span class="o">.</span><span class="n">doCPA</span><span class="p">(</span><span class="n">measuredPower</span><span class="o">=</span><span class="n">measuredPower</span><span class="p">,</span>
                        <span class="n">hypotheticalPower</span><span class="o">=</span><span class="n">hypotheticalPower</span><span class="p">,</span>
                        <span class="n">numTraces</span><span class="o">=</span><span class="n">NUM_TRACES</span><span class="p">,</span>
                        <span class="n">analysisDir</span><span class="o">=</span><span class="n">analysisDir</span><span class="p">,</span>
                        <span class="n">MTDStride</span><span class="o">=</span><span class="n">MTD_STRIDE</span>
                        <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>In line 7 we import the power model module that will calcualte the hypothetical power matrix.
This module was used in line 35.
After we set the directories and specify input files, we set CROP_START and CROP_END which
selects the first round of the encryption in the power trace.
We set the number of traces to be used in the attack using NUM_TRACES variable and set the step
used in plotting the MTD graph using the variable MTD stride.</p>
<p>Once all setting are complete, we call the doCPA() method in line 40. This method takes the measuredPower matrix,
the hypotheticalPower matrix, the number of traces, the directory used to store results and the MTD stride.</p>
<p>Below, we show the correlation graph and the MTD graph for the first byte of the key.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/cpa_correlation.png"><img alt="_images/cpa_correlation.png" src="_images/cpa_correlation.png" style="height: 350px;" /></a>
<p class="caption"><span class="caption-text">CPA Correlation for key byte-0</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/cpa_MTD.png"><img alt="_images/cpa_MTD.png" src="_images/cpa_MTD.png" style="height: 350px;" /></a>
<p class="caption"><span class="caption-text">CPA MTD graph for key byte-0</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="t_test.html" class="btn btn-neutral float-right" title="T-test Leakage Assessment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cpa.html" class="btn btn-neutral float-left" title="Running Correlation Power Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, CERG

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>